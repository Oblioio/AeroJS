/* AeroJS v0.0.1 - http://oblio.io - @oblioio - (c) 2015 Oblio */
window.Aero=window.Aero||{},Aero.utils=Aero.utils||{},Aero.JSPrograms=Aero.JSPrograms||{},Aero.registerJSProgram=function(a,b){console.log("Aero.registerJSProgram: "+a),console.log("Aero.registerJSProgram2: "+a),Aero.JSPrograms[a]=b},function(a){function b(a){for(var b in a)a.hasOwnProperty(b)&&(a[b]=null);a=null}var c=function(a,b){this.task_arr=[],this.defaultScope=a||this,this.id=b||"",this.verbose=!1};c.prototype={execute:function(a){this.verbose&&console.log("ArrayExecuter | "+this.id+" | execute"),this.addNext(a),this.runStep("")},addNext:function(a){if(this.verbose&&console.log("ArrayExecuter | "+this.id+" | addNext"),"function"==typeof a)this.task_arr.unshift({fn:a,vars:null});else{a.reverse();for(var b=0;b<a.length;b++)a[b]&&this.task_arr.unshift(a[b])}},tackOn:function(a){this.verbose&&console.log("ArrayExecuter | "+this.id+" | tackOn");for(var b=0;b<a.length;b++)this.task_arr.push(a[b]);this.runStep("")},runFunctionInScope:function(a){var b=a[0],c=a[1];a.length>2?a[2]:null;a.length>2?b[c](a[2]):b[c]()},runStep:function(a){if(this.verbose&&console.log("ArrayExecuter | "+this.id+" | runStep"),0!=this.task_arr.length){var c=this.task_arr.shift(),d=c.fn;c.scope=c.scope||this.defaultScope,c.vars=c.vars||[],"string"==typeof c.vars&&(c.vars=[c.vars]),d.apply(c.scope,c.vars),b(c)}},stepComplete:function(b){this.verbose&&console.log("ArrayExecuter | "+this.id+" | stepComplete"),this.task_arr.length>0&&a.requestAnimationFrame(this.runStep.bind(this))},stepComplete_instant:function(a){this.verbose&&console.log("ArrayExecuter | "+this.id+" | stepComplete_instant"),this.task_arr.length>0&&this.runStep()},clearArrayExecuter:function(){this.verbose&&console.log("ArrayExecuter | "+this.id+" | clearArrayExecuter"),this.task_arr=[]},destroy:function(){for(var a=0;a<this.task_arr.length;a++)b(this.task_arr[a]);this.task_arr=[],this.defaultScope=null}},Aero.utils.ArrayExecuter=c}(window),function(a){var b=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status||0==c.status)try{b(c.responseText)}catch(d){console.error(d)}else console.error("Couldn't load ["+a+"] ["+c.status+"]")},c.open("GET",a,!0),c.overrideMimeType("text/plain; charset=x-user-defined"),c.setRequestHeader("Content-Type","text/plain"),c.send(null)};Aero.utils.XHRLoader=b}(window),function(a){"use strict";function b(a){return[1,0,0,0,0,Math.cos(a),Math.sin(a),0,0,-Math.sin(a),Math.cos(a),0,0,0,0,1]}function c(a,c){return k(a,b(c))}function d(a){return[Math.cos(a),0,-Math.sin(a),0,0,1,0,0,Math.sin(a),0,Math.cos(a),0,0,0,0,1]}function e(a,b){return k(a,d(b))}function f(a){return[a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1]}function g(a,b){var c=n(a);return c[0]*=b,c[4]*=b,c[8]*=b,c[1]*=b,c[5]*=b,c[9]*=b,c[2]*=b,c[6]*=b,c[10]*=b,c[3]*=b,c[7]*=b,c[11]*=b,c}function h(a,b,c){return[1,0,0,0,0,1,0,0,0,0,1,0,a,b,c,1]}function i(a,b,c,d){return k(a,h(b,c,d))}function j(a,b,c,d){var e=a*Math.tan(.5*c),f=-e,g=f*d,h=e*d,i=2*a/(h-g),j=2*a/(e-f),k=(h+g)/(h-g),l=(e+f)/(e-f),m=-(b+a)/(b-a),n=-2*b*a/(b-a),o=[];return o[0]=i,o[4]=0,o[8]=k,o[12]=0,o[1]=0,o[5]=j,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=m,o[14]=n,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,o}function k(a,b){for(var c,d=[],e=4,f=0;e>f;f++)for(var g=0;e>g;g++){c=0;for(var h=0;e>h;h++)c+=a[g+h*e]*b[f*e+h];d.push(c)}return d}function l(a){return[a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]]}function m(a){var b=[],c=a[0],d=a[4],e=a[8],f=a[12],h=a[1],i=a[5],j=a[9],k=a[13],l=a[2],m=a[6],n=a[10],o=a[14],p=a[3],q=a[7],r=a[11],s=a[15];b[0]=j*o*q-k*n*q+k*m*r-i*o*r-j*m*s+i*n*s,b[4]=f*n*q-e*o*q-f*m*r+d*o*r+e*m*s-d*n*s,b[8]=e*k*q-f*j*q+f*i*r-d*k*r-e*i*s+d*j*s,b[12]=f*j*m-e*k*m-f*i*n+d*k*n+e*i*o-d*j*o,b[1]=k*n*p-j*o*p-k*l*r+h*o*r+j*l*s-h*n*s,b[5]=e*o*p-f*n*p+f*l*r-c*o*r-e*l*s+c*n*s,b[9]=f*j*p-e*k*p-f*h*r+c*k*r+e*h*s-c*j*s,b[13]=e*k*l-f*j*l+f*h*n-c*k*n-e*h*o+c*j*o,b[2]=i*o*p-k*m*p+k*l*q-h*o*q-i*l*s+h*m*s,b[6]=f*m*p-d*o*p-f*l*q+c*o*q+d*l*s-c*m*s,b[10]=d*k*p-f*i*p+f*h*q-c*k*q-d*h*s+c*i*s,b[14]=f*i*l-d*k*l-f*h*m+c*k*m+d*h*o-c*i*o,b[3]=j*m*p-i*n*p-j*l*q+h*n*q+i*l*r-h*m*r,b[7]=d*n*p-e*m*p+e*l*q-c*n*q-d*l*r+c*m*r,b[11]=e*i*p-d*j*p-e*h*q+c*j*q+d*h*r-c*i*r,b[15]=d*j*l-e*i*l+e*h*m-c*j*m-d*h*n+c*i*n;var t=c*b[0]+h*b[4]+l*b[8]+p*b[12];return 0==t?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:b=g(b,1/t)}function n(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]}Aero.Math=Aero.Math||{},Aero.Math.Matrix4={createRotateX:b,rotateX:c,createRotateY:d,rotateY:e,createScale:f,scale:g,createTranslation:h,translate:i,createProjection:j,multiply:k,transpose:l,inverse:m,clone:n}}(window),function(a){"use strict";function b(a){var b=[{fn:i(c,this),vars:"vShader"},{fn:i(c,this),vars:"fShader"},{fn:i(d,this),vars:null},{fn:i(e,this),vars:null},{fn:a,vars:null}];this.arrayExecuter.execute(b)}function c(a){console.log("loadShader: "+this[a].path),Aero.utils.XHRLoader(this[a].path,i(function(b){this[a].text=b,this.arrayExecuter.stepComplete()},this))}function d(){console.log("createProgram");var a=this.gl,b=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(b,this.fShader.text),a.compileShader(b),h.call(this,a,"2d-fragment-shader",b)){this.fShader.obj=b;var c=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(c,this.vShader.text),a.compileShader(c),h.call(this,a,"2d-vertex-shader",c)){this.vShader.obj=c;var d=a.createProgram();a.attachShader(d,c),a.attachShader(d,b),a.linkProgram(d),a.getProgramParameter(d,a.LINK_STATUS)||console.log("Unable to initialize the shader program."),a.useProgram(d),this.program=d,a.program=d,this.arrayExecuter.stepComplete()}}}function e(){var a,b,c,d,e=this.gl,f=this.settings.uniforms;this.uniforms=[],this.inputs={};for(var g in f){switch(a=f[g],b=e.getUniformLocation(this.program,g),c=a.val,a.type){case"f":case"1f":d=Aero.GLUploaders.uniform1f;break;case"2f":d=Aero.GLUploaders.uniform2f;break;case"3f":d=Aero.GLUploaders.uniform3f;break;case"3m":d=Aero.GLUploaders.uniformMatrix3fv;break;case"4f":d=Aero.GLUploaders.uniform4f;break;case"4m":d=Aero.GLUploaders.uniformMatrix4fv;break;case"t":d=Aero.GLUploaders.uniform1i;break;default:console.log("uniform type: "+a.type+" not yet setup"),d=!1}this.inputs[g]=c,this.uniforms.push({id:g,type:a.type,loc:b,fn:d})}this.arrayExecuter.stepComplete()}function f(){for(var a,b=this.gl,c=this.uniforms.length;c--;)a=this.uniforms[c],a.fn&&a.fn(b,a.loc,this.inputs[a.id])}function g(){var a=this.gl;a.useProgram(this.program),a.program=this.program,this.updateUniforms(),a.drawArrays(a[this.settings.renderMode],0,4)}function h(a,b,c){var d=this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS);return d||console.log("Error compiling "+b+": "+this.gl.getShaderInfoLog(c)),d}function i(a,b){return function(){return a.apply(b,arguments)}}var j=function(a,b){this.arrayExecuter=new Aero.utils.ArrayExecuter(this),this.type="GLProgram",this.inRenderList=!1,this.scene=b,this.gl=this.scene.gl,this.settings={renderMode:"TRIANGLE_STRIP"};for(var c in a)this.settings[c]=a[c];this.drawToCanvas=!1,this.clearBuffer="true"==String(a.clearBuffer).toLowerCase()?!0:!1,console.log("this.clearBuffer: "+this.clearBuffer),this.vShader={path:this.settings.vertexShader.replace("~/",this.scene.dirPath)},this.fShader={path:this.settings.fragmentShader.replace("~/",this.scene.dirPath)}};j.prototype.init=b,j.prototype.updateUniforms=f,j.prototype.render=g,Aero.GLProgram=j}(window),function(a){"use strict";function b(a){this.onLoadComplete=a?a:null,this.imgURL||(console.log("loadTexture ERROR: no image url"),this.onLoadComplete(),this.onLoadComplete=null),console.log("loadTexture: "+this.imgURL),this.imgObj=new Image,this.imgObj.onload=d(c,this),this.imgObj.src=this.imgURL}function c(){var a=this.gl,b=this.texture;a.activeTexture(a["TEXTURE"+this.texUnit]),a.bindTexture(a.TEXTURE_2D,b),this.width=this.imgObj.width,this.height=this.imgObj.height,a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.imgObj),this.onLoadComplete&&(this.onLoadComplete(),this.onLoadComplete=null)}function d(a,b){return function(){return a.apply(b,arguments)}}var e=function(a,b){var c=b.gl,d=c.createTexture();this.type="texture",this.inRenderList=!1,this.scene=b,this.settings=a,this.imgURL=a.imgURL?a.imgURL.replace("~/",this.scene.dirPath):null,this.texUnit=a.texUnit,console.log("GLTexture Init: "+this.texUnit),this.gl=c,this.texture=d,c.activeTexture(c["TEXTURE"+this.texUnit]),c.bindTexture(c.TEXTURE_2D,d),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!0),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR)};e.prototype.loadTexture=b,Aero.GLTexture=e}(window),function(a){"use strict";var b=function(a,b){};b.prototype.uniform1f=function(a,b,c){a.uniform1f(b,c)},b.prototype.uniform2f=function(a,b,c){a.uniform2f(b,c[0],c[1])},b.prototype.uniform3f=function(a,b,c){a.uniform3f(b,c[0],c[1],c[2])},b.prototype.uniform4f=function(a,b,c){a.uniform4f(b,c[0],c[1],c[2],c[3])},b.prototype.uniform1i=function(a,b,c){a.uniform1i(b,c)},b.prototype.uniform2i=function(a,b,c){a.uniform2i(b,c)},b.prototype.uniform3i=function(a,b,c){a.uniform3i(b,c)},b.prototype.uniform4i=function(a,b,c){a.uniform3i(b,c)},b.prototype.uniformMatrix2fv=function(a,b,c){a.uniformMatrix2fv(b,a.FALSE,c)},b.prototype.uniformMatrix3fv=function(a,b,c){a.uniformMatrix3fv(b,a.FALSE,c)},b.prototype.uniformMatrix4fv=function(a,b,c){a.uniformMatrix4fv(b,a.FALSE,c)},Aero.GLUploaders=new b}(window),function(a){"use strict";function b(){}Aero=Aero||{},Aero.Renderer=b}(window),function(a){"use strict";function b(a){console.log("loadJSON"),Aero.utils.XHRLoader(a,A(c,this))}function c(a){console.log("JSONLoaded"),a=JSON.parse(a),this.data=a,this.arrayExecuter.stepComplete()}function d(){console.log("processJSON");var a=this.data;a.settings.dirPath&&(this.dirPath=a.settings.dirPath),this.canvas.width=a.settings.dimensions.width,this.canvas.height=a.settings.dimensions.height;var b=a.settings.preserveDrawingBuffer&&"true"==String(a.settings.preserveDrawingBuffer).toLowerCase()?!0:!1;this.gl=this.canvas.getContext("webgl",{preserveDrawingBuffer:b})||this.canvas.getContext("experimental-webgl",{preserveDrawingBuffer:b}),this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.nextTexUnit=0,this.arrayExecuter.stepComplete()}function e(a){console.log('ERROR: cannot have more than one node with id "'+a+'"')}function f(){var a=this.nextTexUnit;return a>=this.maxTextureUnits&&console.log("ERROR: TexUnit "+a+" | Only "+this.maxTextureUnits+" are supported."),this.nextTexUnit++,a}function g(){console.log("/////////////////  createTextures  /////////////////");var a=this.data.textures,b=[];this.createTexture=A(h,this),this.textures={};for(var c in a){if(this.nodes.hasOwnProperty(c))return void e(c);var d=this.createTexture(a[c]);this.textures[c]=d,this.nodes[c]=d,d.id=c,b.push({fn:A(d.loadTexture,d),vars:[this.stepComplete]})}this.arrayExecuter.execute(b)}function h(a){return new Aero.GLTexture({imgURL:a,texUnit:this.getNextTexUnit()},this)}function i(){console.log("/////////////////  createJSPrograms  /////////////////");var a=this.data.jsPrograms||this.data.JSPrograms,b=[],c=[];this.createNextJSProgram=A(k,this),this.JSPrograms={};for(var d in a){if(this.nodes.hasOwnProperty(d))return void e(d);var f,g,h;if(a[d].dependencies&&a[d].dependencies.length)for(f=0;f<a[d].dependencies.length;f++){for(h=!1,a[d].dependencies[f]=a[d].dependencies[f].replace("~/",this.dirPath),g=0;g<c.length;g++)a[d].dependencies[f]==c[g]&&(h=!0);h||(c.push(a[d].dependencies[f]),b.push({fn:j,vars:[a[d].dependencies[f],this.stepComplete]}))}this.JSPrograms[d]={data:a[d],obj:!1},b.push({fn:this.createNextJSProgram,vars:String(""+d)})}this.arrayExecuter.execute(b)}function j(a,b){var c=document.createElement("script");c.type="text/javascript",c.src=a;var d=function(){console.log("add script: loaded"),b(a)};if("undefined"!=typeof c.addEventListener)c.addEventListener("load",d,!1);else{var e=function(){"loaded"==c.readyState&&d(a)};c.attachEvent("onreadystatechange",e)}document.getElementsByTagName("head")[0].appendChild(c)}function k(a){if(console.log("createNextJSProgram: "+a),!Aero.JSPrograms[this.JSPrograms[a].data.id])return void console.log("There is no registered JSProgram with the id: "+this.JSPrograms[a].data.id);var b=new Aero.JSPrograms[this.JSPrograms[a].data.id](this.JSPrograms[a].data,this);this.JSPrograms[a]=b,this.nodes[a]=b,b.id=a,b.type="JSProgram",b.dependents=[],b.init?b.init(this.stepComplete):this.arrayExecuter.stepComplete(),b.run||(b.run=function(){})}function l(){console.log("/////////////////  createGLPrograms  /////////////////");var a=this.data.glPrograms||this.data.GLPrograms,b=[];this.GLPrograms={};for(var c in a){if(this.nodes.hasOwnProperty(c))return void e(c);var d=new Aero.GLProgram(a[c],this);this.GLPrograms[c]=d,this.nodes[c]=d,d.id=c,d.dependents=[],b.push({fn:A(d.init,d),vars:[this.stepComplete]})}this.arrayExecuter.execute(b)}function m(){console.log("/////////////////  createRenderList  /////////////////");var a,b,c,d,e,f,g,h,i,j,k=this.data.connections,l=n(k,"dest","canvas");for(q=0;q<l.length;q++)e=o.call(this,l[q],"source"),e.drawToCanvas=!0;for(this.renderList=[];l.length;)if(a=l.shift(),g=h=!1,b=o.call(this,a,"source"),console.log("checking node: "+b.id),!b.inRenderList){for(b.inRenderList=!0,c=n(k,"source",a.source.id),i=0;i<c.length;i++)e=o.call(this,c[i],"dest"),e&&("texture"==b.type&&(e.inputs[c[i].dest["var"]]=b.texUnit),"GLProgram"==b.type&&b.dependents.push({id:e.id,destVar:c[i].dest["var"]}),"JSProgram"==b.type&&(console.log("add output to JSProgram"),b.dependents.push({obj:e,id:e.id,sourceVar:c[i].source["var"],destVar:c[i].dest["var"]})),f=p(this.renderList,e),c[i].feedback&&"true"==String(c[i].feedback).toLowerCase()||f!==!1&&(h=h!==!1?Math.min(f,h):f));for(d=n(k,"dest",a.source.id),j=0;j<d.length;j++)e=o.call(this,d[j],"source"),e&&(e.inRenderList||l.unshift(d[j]),f=p(this.renderList,e),d[j].feedback&&"true"==String(d[j].feedback).toLowerCase()||f!==!1&&(g=g!==!1?Math.max(f,g):f));if(console.log("adding: "+b.id+", highestIndex: "+h+", lowestIndex: "+g),g!==!1&&h!==!1&&g>=h)return void console.log("createRenderList: FEEDBACK LOOP! lowestIndex is greater than highestIndex");h!==!1?this.renderList.splice(h,0,b):g!==!1?this.renderList.splice(g+1,0,b):this.renderList.push(b)}for(var m="RENDER ORDER: ",q=0;q<this.renderList.length;q++)m+=this.renderList[q].id+" > ";console.log(m),this.arrayExecuter.stepComplete()}function n(a,b,c){for(var d=[],e=0;e<a.length;e++)a[e][b].id.toLowerCase()==String(c).toLowerCase()&&d.push(a[e]);return d}function o(a,b){var c=!1,d=!1;return(c=this.nodes)?(d=c[a[b].id],d?d:(console.log('getConnectedNode: node id "'+a[b].id+'" returned no results'),!1)):(console.log("getConnectedNode: node type "+a[b].type+" returned no results"),!1)}function p(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return!1}function q(){console.log("/////////////////  createFrameBuffers  /////////////////"),this.frameBuffers=[];var a,b,c,d,e,f;if(this.data.frameBuffers)for(var e in this.data.frameBuffers){var g=this.data.frameBuffers[e];if(g.nodes&&g.nodes.length)for(a=r.call(this,0),a.holdForever=!0,f=0;f<g.nodes.length;f++)b=this.nodes[g.nodes[f]],b?b.forcedBuffer=a:console.log('Could not assign frame buffer "'+e+'" to node "'+g.nodes[f]+'" because it does not exist')}for(e=0;e<this.renderList.length;e++)if(b=this.renderList[e],"texture"!=b.type&&("JSProgram"!=b.type||b.draws)&&!b.drawToCanvas&&b.dependents&&b.dependents.length){for(b.forcedBuffer?(a=b.forcedBuffer,b.forcedBuffer=null):a=r.call(this,e),b.outputs=b.outputs||{},b.outputs.texUnit=a.texUnit,f=0;f<b.dependents.length;f++)c=this.nodes[b.dependents[f].id],"GLProgram"==c.type&&(c.inputs[b.dependents[f].destVar]=a.texUnit),d=p(this.renderList,c),a.holdIndex=Math.max(d,a.holdIndex);b.outputBuffer=a.index}this.arrayExecuter.stepComplete()}function r(a){for(var b=0;b<this.frameBuffers.length;b++)if(!this.frameBuffers[b].holdForever&&this.frameBuffers[b].holdIndex<a)return this.frameBuffers[b];var c=s.call(this);return c.index=this.frameBuffers.length,c.holdIndex=0,this.frameBuffers.push(c),c}function s(){var a,b,c=this.gl,d=c.createRenderbuffer(),e=this.canvas.width,f=this.canvas.height,g=this.getNextTexUnit();return console.log("createFrameBuffer: texUnit "+g),a=c.createFramebuffer(),c.activeTexture(c["TEXTURE"+g]),c.bindFramebuffer(c.FRAMEBUFFER,a),b=c.createTexture(),c.bindTexture(c.TEXTURE_2D,b),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,e,f,0,c.RGBA,c.UNSIGNED_BYTE,null),c.bindRenderbuffer(c.RENDERBUFFER,d),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,e,f),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,d),c.bindRenderbuffer(c.RENDERBUFFER,null),c.bindFramebuffer(c.FRAMEBUFFER,null),{frameBuffer:a,texture:b,renderBuffer:d,width:e,height:f,texUnit:g}}function t(){var a=this.gl,b=new Float32Array([-1,1,0,1,-1,-1,0,0,1,1,1,1,1,-1,1,0]),c=a.createBuffer();return c?(a.bindBuffer(a.ARRAY_BUFFER,c),a.bufferData(a.ARRAY_BUFFER,b,a.STATIC_DRAW),this.standardVertexBuffer={buffer:c,array:b,fsize:b.BYTES_PER_ELEMENT},this.usingStandardVertexBuffer=!1,void this.arrayExecuter.stepComplete()):(console.log("Failed to create the buffer object"),-1)}function u(){var a=this.gl;this.usingStandardVertexBuffer=!0,a.bindBuffer(a.ARRAY_BUFFER,this.standardVertexBuffer.buffer),v(a,"a_Position",this.standardVertexBuffer.fsize,2,4,0),v(a,"a_TexCoord",this.standardVertexBuffer.fsize,2,4,2)}function v(a,b,c,d,e,f){var g=a.getAttribLocation(a.program,b);return 0>g?(console.log("Failed to get the attribute storage location of "+b),!1):(a.vertexAttribPointer(g,d,a.FLOAT,!1,c*e,c*f),a.enableVertexAttribArray(g),!0)}function w(a,b){var c=this.gl;this.usingStandardVertexBuffer=!1;var d=c.createBuffer();return d?(c.bindBuffer(c.ARRAY_BUFFER,d),c.bufferData(c.ARRAY_BUFFER,a,c.DYNAMIC_DRAW),{buffer:d,length:a.length,data:a,fsize:a.BYTES_PER_ELEMENT,attributes:b}):(console.log("Failed to create the buffer object"),-1)}function x(a){var b=this.gl;this.usingStandardVertexBuffer=!1,b.bindBuffer(b.ARRAY_BUFFER,a.buffer),a.data.length>a.length?(a.length=a.data.length,b.bufferData(b.ARRAY_BUFFER,a.data,b.DYNAMIC_DRAW)):b.bufferSubData(b.ARRAY_BUFFER,0,a.data)}function y(a){var b=this.gl;this.usingStandardVertexBuffer=!1,b.bindBuffer(b.ARRAY_BUFFER,a.buffer);for(var c=a.attributes.length;c--;)v(b,a.attributes[c].id,a.fsize,a.attributes[c].num,a.attributes[c].stride,a.attributes[c].start)}function z(){for(var b,c,d=this.gl,e=0;e<this.renderList.length;e++)switch(b=this.renderList[e],b.type){case"GLProgram":b.drawToCanvas?d.bindFramebuffer(d.FRAMEBUFFER,null):(d.bindFramebuffer(d.FRAMEBUFFER,this.frameBuffers[b.outputBuffer].frameBuffer),b.clearBuffer&&d.clear(d.COLOR_BUFFER_BIT)),d.useProgram(b.program),d.program=b.program,this.usingStandardVertexBuffer||this.useStandardVertexBuffer(this),b.updateUniforms(),b.render();break;case"JSProgram":for(b.draws&&(b.drawToCanvas?d.bindFramebuffer(d.FRAMEBUFFER,null):(d.bindFramebuffer(d.FRAMEBUFFER,this.frameBuffers[b.outputBuffer].frameBuffer),b.clearBuffer&&d.clear(d.COLOR_BUFFER_BIT))),b.run(),c=b.dependents.length;c--;)b.dependents[c].obj.inputs[b.dependents[c].destVar]=b.outputs[b.dependents[c].sourceVar];break;case"texture":}a.requestAnimationFrame(A(z,this))}function A(a,b){return function(){return a.apply(b,arguments)}}var B=function(a,c){console.log("Scene"),this.arrayExecuter=new Aero.utils.ArrayExecuter(this),this.stepComplete=A(this.arrayExecuter.stepComplete,this.arrayExecuter),c&&c.canvas?this.canvas=c.canvas:this.canvas=document.createElement("canvas"),this.nodes={};var e=[{fn:d,vars:a},{fn:g,vars:null},{fn:i,vars:null},{fn:l,vars:null},{fn:m,vars:null},{fn:q,vars:null},{fn:t,vars:null},{fn:z,vars:null}];"string"==typeof a?(this.dirPath=a.indexOf("/")>=0?a.substring(0,a.lastIndexOf("/")+1):"",e.unshift({fn:b,vars:a})):(this.data=a,this.dirPath=""),this.arrayExecuter.execute(e)};B.prototype.draw=z,B.prototype.getNextTexUnit=f,B.prototype.useStandardVertexBuffer=u,B.prototype.useCustomVertexBuffer=y,B.prototype.createCustomVertexBuffer=w,B.prototype.updateCustomVertexBuffer=x,Aero.Scene=B}(window);